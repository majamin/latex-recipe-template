\ProvidesPackage{style/recipes}[2025/07/27 v1.1 Recipe styling with checkboxes]

% === Dependencies ===
\RequirePackage[most]{tcolorbox}
\tcbuselibrary{raster}
\RequirePackage[margin=1in]{geometry}
\RequirePackage{XCharter}
\RequirePackage{enumitem}
\RequirePackage{fontspec}
\RequirePackage{amssymb}
\RequirePackage{xparse}
\RequirePackage{array}

% === Fonts ===
\newfontfamily\headingfont[
	Path = fonts/,
	Extension = .ttf,
]{Montserrat-ExtraBold}

% === Todo-style ingredient list using checkboxes ===
\newlist{inglist}{itemize}{1}
\setlist[inglist]{label={}, leftmargin=*, itemsep=0.4em, topsep=0pt, parsep=0pt}

% === Directions list with automatic numbers ===
\newlist{dirlist}{enumerate}{1}
\setlist[dirlist]{label=\arabic*., leftmargin=*, itemsep=0.75em}

% === Item Macros ===
\NewDocumentCommand{\ingred}{ m g }{%
	\item\leavevmode
	\begin{tabular}[t]
		{@{}>{\raggedleft\arraybackslash}p{0.22\linewidth}
		@{\hspace{1em}}
		>{\raggedright\arraybackslash}p{0.74\linewidth}@{}}%
		\IfNoValueTF{#2}{
			% One-column style: blank left, right-aligned text
		\mbox{}                                                                               & #1 %
		}{
			% Two-column style: amount & ingredient
		\raisebox{\dimexpr-\height+0.75\ht\strutbox\relax}{\color{black!80}\scshape\small #1} & #2 %
		}
	\end{tabular}%
}
\newcommand{\direct}[1]{\item #1}

% === Recipe Title and Info Storage ===
\newcommand{\recipeTitle}[1]{\def\@recipeTitle{#1}}
\newcommand{\recipeDescription}[1]{\def\@recipeDescription{#1}}
\newcommand{\recipeInfo}[1]{\def\@recipeInfo{#1}}

% default empty fallback
\def\@recipeDescription{}

% === Recipe Layout Container ===
\NewDocumentEnvironment{Recipe}{ O{13} }{%
	\clearpage
	{\centering
		{\headingfont\Huge\bfseries \@recipeTitle \par}
		\vspace{0.6em}
		{\sffamily\small\itshape \@recipeDescription \par}
		\vspace{1.0em}
		\noindent\hrule height 1pt
		\vspace{0.5em}
		{\@recipeInfo \par}
		\vspace{0.5em}
		\noindent\hrule height 2pt
		\vspace{1.5em}
	}
	\begin{tcbraster}[
			raster columns=#1,
			raster equal height,
			raster column skip=2mm
		]
		}{%
	\end{tcbraster}
}

% === Box Styling ===
\tcbset{
	recipebox/.style={
			lower separated=false,
			arc=0.1mm,
			top=5mm,
			bottom=5mm,
			colback=white,
			colframe=black!50,
			colbacktitle=white,
			coltitle=black,
			fonttitle=\headingfont,
			enhanced,
			attach boxed title to top left={yshift=-0.12in,xshift=0.15in},
			boxed title style={boxrule=0pt, colframe=white},
		}
}

% === Recipe Content Boxes ===

% Ingredients: checkbox list (via todolist)
\newtcolorbox{RecipeIngredients}[1][]{
	recipebox,
	raster multicolumn=5,
	title=\uppercase{\large\textbf{ingredients}},
	before upper={\begin{inglist}},
				after upper={\end{inglist}},
	#1
}

% Directions: numbered list
\newtcolorbox{RecipeDirections}[1][]{
	recipebox,
	raster multicolumn=8,
	title=\uppercase{\large\textbf{directions}},
	before upper={\begin{dirlist}},
				after upper={\end{dirlist}},
	#1
}

% === Optional Note Box ===
\NewDocumentEnvironment{RecipeNote}{ O{} }{%
	\par\vspace{1.5em}
	\noindent
	\begin{minipage}[t]{0.12\linewidth}
		\raggedright\sffamily\bfseries\small NOTE
	\end{minipage}%
	\hspace{1em}%
	\begin{minipage}[t]{0.83\linewidth}
		\itshape
		}{%
	\end{minipage}
	\par\vspace{1.5em}
}
